<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>

</head>

<body>
    <div class="todo-container">
        <h1>Danh Sách Công Việc</h1>
        <div class="input-section">
            <div class="input-group">
                <input type="text" id="todoInput" placeholder="Nhập công việc mới..." />
                <button id="actionButton" onclick="addTodo()">Thêm</button>
            </div>
            <div id="errorMessage" class="error-message">Vui lòng nhập công việc!</div>
        </div>
        <div class="filter-section">
            <button onclick="filterTodos('all')" class="active">Tất cả</button>
            <button onclick="filterTodos('active')">Chưa hoàn thành</button>
            <button onclick="filterTodos('completed')">Hoàn thành</button>
        </div>
        <ul class="todo-list" id="todoList"></ul>
    </div>



</body>


</html>
<script>
    
 // Lấy các phần tử DOM theo ID
const todoInput = document.getElementById("todoInput") // Lấy phần tử input để nhập task mới
const actionButton = document.getElementById("actionButton") // Lấy nút để thêm hoặc sửa task
const errorMessage = document.getElementById("errorMessage") // Lấy phần tử hiển thị thông báo lỗi
const todoList = document.getElementById("todoList") // Lấy phần tử để hiển thị danh sách công việc

let todoEditing = null // Biến lưu trữ thông tin task đang chỉnh sửa

// Hàm tạo ID ngẫu nhiên cho todo mới
function generateRandomID(length) {
    let characters = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789"; // Tập ký tự có thể sử dụng cho ID
    let id = 'todo-'; // Khởi tạo ID với tiền tố "todo-"
    for (let i = 0; i < length; i++) {
        let index = Math.floor(Math.random() * characters.length) // Tạo chỉ số ngẫu nhiên từ mảng characters
        id += characters[index] // Thêm ký tự ngẫu nhiên vào ID
    }
    return id // Trả về ID đã tạo
}

// Lấy dữ liệu todos từ localStorage
function getData() {
    return JSON.parse(localStorage.getItem('todos') || "[]") // Trả về dữ liệu từ localStorage, nếu không có thì trả về mảng rỗng
}

// Lưu dữ liệu todos vào localStorage
function handleLocal(todo) {
    localStorage.setItem('todos', JSON.stringify(todo)) // Lưu mảng todos dưới dạng JSON vào localStorage
}

// Lấy dữ liệu todos hiện tại từ localStorage và lưu vào biến todoUI
let todoUI = getData()

// Hàm hiển thị thông báo lỗi
function handleErrorMessage(text) {
    errorMessage.style.display = "block" // Hiển thị phần tử lỗi
    errorMessage.innerHTML = text // Hiển thị thông báo lỗi
}

// Hàm reset input và thông báo lỗi sau khi thêm/sửa todo
function reset() {
    todoInput.value = "" // Xóa giá trị trong ô nhập liệu
    errorMessage.style.display = "none" // Ẩn thông báo lỗi
    actionButton.innerHTML = "Them" // Đặt lại nội dung của nút hành động về "Thêm"
}

// Hàm hiển thị danh sách todo
function renderUI(dataList) {
    if (!Array.isArray(dataList)) { // Kiểm tra xem dữ liệu có phải là mảng không
        handleErrorMessage("Sai dinh dang du lieu") // Nếu không phải mảng, hiển thị lỗi
    }
    if (dataList.length === 0) { // Nếu danh sách rỗng
        todoList.innerHTML = "Khong co du lieu" // Hiển thị thông báo không có dữ liệu
    }
    todoList.innerHTML = `` // Xóa toàn bộ nội dung của todoList trước khi render lại 
    dataList.forEach((todo) => { // Lặp qua từng todo trong danh sách
        const li = document.createElement('li') // Tạo một thẻ li cho mỗi todo
        li.className = `todo-item ${todo.completed ? 'completed' : ''}` // Thêm lớp CSS tùy thuộc vào trạng thái hoàn thành của todo
        li.innerHTML = ` 
         <span class="status ${todo.completed ? 'completed' : 'active'}" 
                onclick="toggleTodo('${todo.id}')">
            ${todo.completed ? 'Hoàn thành' : 'Chưa hoàn thành'} 
          </span>
            <span class = "task-id">${todo.id}</span> <!-- Hiển thị ID của task -->
            <span class = "task-text">${todo.title}</span> <!-- Hiển thị tiêu đề task -->
            <button class= "delete" onclick="deleteTodo('${todo.id}')">Xoa</button> <!-- Nút xóa task -->
            <button class= "edit" onclick="editTodo('${todo.id}')">Sua</button> <!-- Nút sửa task -->
        `
        todoList.appendChild(li) // Thêm thẻ li vào danh sách todoList
    })
}

// Hàm thêm hoặc sửa todo
function addTodo() {
    todoUI = getData() // Lấy lại dữ liệu todos từ localStorage
    const value = todoInput.value.trim() // Lấy giá trị nhập vào từ todoInput, loại bỏ khoảng trắng
    if (value === "") { // Nếu không có dữ liệu nhập vào
        handleErrorMessage("Vui long nhap du lieu") // Hiển thị thông báo lỗi
        return // Dừng lại, không thực hiện thêm todo
    }
    if (todoEditing) { // Kiểm tra nếu đang chỉnh sửa todo
        const todoElement = todoUI.find((todo) => todo.id === todoEditing.id) // Tìm todo cần chỉnh sửa
        if (todoElement) { // Nếu tìm thấy
            todoElement.title = value // Cập nhật tiêu đề cho todo
            handleLocal(todoUI) // Lưu lại danh sách todos đã sửa vào localStorage
            reset() // Reset input và thông báo lỗi
            renderUI(getData()) // Render lại giao diện
        }
    } else { // Nếu không phải chỉnh sửa, thêm mới todo
        const todo = {
            id: generateRandomID(3), // Tạo ID ngẫu nhiên cho todo mới
            title: value, // Lấy tiêu đề nhập vào
            completed: false // Đánh dấu trạng thái chưa hoàn thành
        }
        handleLocal([...todoUI, todo]) // Lưu todo mới vào danh sách todos
        reset() // Reset input và thông báo lỗi
        renderUI(getData()) // Render lại giao diện
    }
}

// Hàm xóa todo
function deleteTodo(idTodo) {
    todoUI = getData() // Lấy lại dữ liệu todos từ localStorage
    todoUI = todoUI.filter((todo) => todo.id !== idTodo) // Lọc bỏ todo có ID trùng với idTodo
    handleLocal([...todoUI]) // Lưu lại danh sách todos đã xóa vào localStorage
    renderUI(getData()) // Render lại giao diện
}

// Hàm chỉnh sửa todo
function editTodo(idTodo) {
    todoInput.focus() // Đặt con trỏ vào ô nhập liệu
    todoUI = getData() // Lấy lại dữ liệu todos từ localStorage
    const todoEdit = todoUI.find((todo) => todo.id === idTodo) // Tìm todo cần chỉnh sửa
    if (todoEdit) { // Nếu tìm thấy todo
        actionButton.innerHTML = "Sua" // Đổi nội dung nút hành động thành "Sửa"
        todoInput.value = todoEdit.title // Đưa tiêu đề todo vào ô nhập liệu
        todoEditing = todoEdit // Lưu todo đang chỉnh sửa vào biến todoEditing
    }
}

// Hàm đổi trạng thái hoàn thành của todo
function toggleTodo(idToggle) {
    todoUI = getData() // Lấy lại dữ liệu todos từ localStorage
    const todoToggle = todoUI.find((todo) => todo.id === idToggle) // Tìm todo cần thay đổi trạng thái
    todoToggle.completed = !todoToggle.completed // Đổi trạng thái hoàn thành của todo
    handleLocal(todoUI) // Lưu lại danh sách todos với trạng thái mới vào localStorage
    renderUI(getData()) // Render lại giao diện
}

// Hàm lọc todo theo trạng thái
function filterTodos(status) {
    console.log(status); // In ra trạng thái lọc (all, active, completed)
    todoUI = getData() // Lấy lại dữ liệu todos từ localStorage
    let filterTodo = [] // Khởi tạo mảng lọc todo
    switch (status) {
        case "all":
            filterTodo = todoUI // Lọc tất cả todo
            break;
        case "active":
            filterTodo = todoUI.filter(item => !item.completed) // Lọc các todo chưa hoàn thành
            break;
        case "completed":
            filterTodo = todoUI.filter(item => item.completed) // Lọc các todo đã hoàn thành
            break;
        default:
            filterTodo = todoUI // Nếu không phải "all", "active", "completed", lọc tất cả todo
            break;
    }
    const button = document.querySelectorAll('.filter-section button') // Lấy tất cả các nút lọc
    button.forEach((btn) => btn.classList.remove('active')) // Xóa lớp 'active' của tất cả các nút lọc
    document.querySelector(`.filter-section button[onclick="filterTodos('${status}')"]`).classList.add("active") // Thêm lớp 'active' cho nút đang được chọn
    renderUI(filterTodo) // Render lại giao diện với danh sách đã lọc
}

// Thêm sự kiện cho nút thêm todo
actionButton.addEventListener('submit', addTodo) // Khi nút "Thêm" được nhấn, gọi hàm addTodo

renderUI(getData()) // Render giao diện ban đầu với dữ liệu từ localStorage

</script>